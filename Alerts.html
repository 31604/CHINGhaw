<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Alerts - IoT Dashboard</title>
<style>
body{
  font-family:Arial, sans-serif;
  margin:0; padding:0;
  background:#f8fafc; color:#1e293b;
  transition: background 0.3s, color 0.3s;
}
body.dark{ background:#1e293b; color:white; }

.topbar{
  position:fixed; top:0; left:0; right:0; height:55px;
  background:#1e293b; color:white; display:flex;
  align-items:center; justify-content:space-between; padding:0 20px; z-index:999; font-weight:600;
}

#menuButton, #themeButton{
  border:none; border-radius:5px; cursor:pointer;
}
#menuButton{ background:#3b82f6; color:white; font-size:22px; padding:6px 10px; }
#menuButton:hover{ background:#2563eb; }
#menuButton.open{ transform:rotate(90deg); }
#themeButton{ background:#fbbf24; color:white; font-size:14px; padding:6px 10px; }

#sidebar{
  position:fixed; top:0; left:-280px; width:280px; height:100%;
  background:#1e293b; color:white; padding:20px; transition:left 0.3s ease; z-index:1000;
  display:flex; flex-direction:column; gap:15px; overflow-y:auto;
}
#sidebar.active{ left:0; }
#sidebar h2{ margin-top:0; color:#3b82f6; }
#sidebar a{ color:white; text-decoration:none; padding:8px 12px; border-radius:5px; }
#sidebar a:hover{ background:#334155; }

.container{ padding:80px 20px; max-width:1300px; margin:auto; }
.panel{ background:white; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.08); margin-bottom:20px; }
.panel.dark{ background:#334155; color:white; }

h1{text-align:center; margin-top:60px; margin-bottom:20px;}
ul#alertsList{ list-style:none; padding:0; }
ul#alertsList li{ padding:10px; border-radius:8px; margin-bottom:10px; font-weight:bold; }
ul#alertsList li.alert{ background:#f87171; color:white; }
ul#alertsList li.warning{ background:#facc15; color:black; }
</style>
</head>
<body>

<div class="topbar">
  <button id="menuButton" onclick="toggleSidebar()">‚ò∞</button>
  <div>Alerts</div>
  <button id="themeButton" onclick="toggleTheme()">üåó</button>
</div>

<div id="sidebar">
  <h2>Menu</h2>
  <a href="index.html">üè† Dashboard</a>
  <a href="alerts.html">üö® Alerts</a>
  <a href="devices.html">üñ•Ô∏è Devices</a>
  <a href="settings.html">‚öôÔ∏è Settings</a>
  <a href="help.html">‚ùì Help</a>
  <a href="about.html">‚ÑπÔ∏è About</a>
  <a href="login.html">üîí Logout</a>
</div>

<div class="container">
  <h1>Live Alerts</h1>
  <div class="panel">
    <ul id="alertsList"></ul>
  </div>
</div>

<script>
/* === Sidebar & Theme === */
function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("active"); document.getElementById("menuButton").classList.toggle("open"); }
function toggleTheme(){ 
  document.body.classList.toggle("dark"); 
  document.querySelectorAll(".panel").forEach(el=>el.classList.toggle("dark")); 
  localStorage.setItem("theme", document.body.classList.contains("dark")?"dark":"light");
}
const theme = localStorage.getItem("theme") || "light";
document.body.classList.toggle("dark", theme==="dark");

/* === Alerts Fetch === */
const raspberryIP="192.168.43.180";
async function fetchAlerts(){
  try{
    const response=await fetch(`http://${raspberryIP}/alerts`);
    const alerts=await response.json();
    const list=document.getElementById("alertsList");
    if(alerts.length===0){ list.innerHTML="<li>No alerts</li>"; return; }
    list.innerHTML="";
    alerts.forEach(a=>{
      const cls=a.level.toLowerCase()==="critical"?"alert":"warning";
      const time=new Date(a.time).toLocaleTimeString();
      list.innerHTML+=`<li class="${cls}">[${time}] ${a.message}</li>`;
    });
  }catch(e){ console.error(e); document.getElementById("alertsList").innerHTML="<li>Failed to fetch alerts</li>"; }
}

/* Auto-update every 5 sec */
fetchAlerts();
setInterval(fetchAlerts,5000);
</script>

</body>
</html>